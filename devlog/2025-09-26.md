# Devlog - September 26, 2025

## Objective

To fix a critical bug where the timer for the "Economic Suicide Tactic" (`OriginalSummonTick`) was incorrectly resetting every time the player teleported or changed maps. This made the feature unreliable and effectively unusable.

## Summary of Changes

The root cause was discovered to be the game client completely reloading the AI script on every map change, which wiped all global variables (like timers and state flags) from memory. To solve this, we implemented a file-based persistence system.

1.  **`AI_main.lua` - Implemented State Persistence:**
    *   Created a new `loadtimeouts(myid)` function to read saved variables from a character-specific `Timeouts.lua` file.
    *   Modified the existing `UpdateTimeoutFile()` function to save not only `OriginalSummonTick` and `SummonTick`, but also the crucial `homunculusConfirmedGone` boolean flag.
    *   This ensures that the AI's memory of the homunculus's initial summon time and its death status can survive a full script reload.

2.  **`AI_main.lua` - Corrected Execution Order:**
    *   Discovered that the main `AI(myid)` function was being executed by the game client *before* the `doInit(myid)` initialization function.
    *   Moved the call to `loadtimeouts(myid)` to the very top of the `AI(myid)` function. This guarantees that the persistent state is loaded immediately upon script execution, before any other logic runs.

3.  **`AI_main.lua` - Refined Invocation Logic:**
    *   Restructured the main invocation logic to be more robust. It now explicitly handles two distinct cases:
        1.  **Homunculus Disappears:** When the homunculus goes from an 'alive' to a 'not alive' state, the AI checks for `MOTION_DEAD` and, if true, sets `homunculusConfirmedGone = true` and immediately calls `UpdateTimeoutFile()` to save this critical state to disk.
        2.  **Homunculus Appears:** When the homunculus appears, the AI checks if it's a true first summon or a re-summon after a confirmed death (by checking the now-persistent `homunculusConfirmedGone` flag). If it is, the timer is reset. Otherwise, it's treated as a teleport, and the timer is preserved.

## Outcome

**Success.** The "Economic Suicide Tactic" is now fully functional and robust. The suicide timer correctly persists across map changes, teleports, and even full game restarts. The timer no longer resets on teleport but correctly resets after the homunculus dies and is re-summoned. This marks a major milestone in the reliability of the YtuAI core.

## Next Steps

- Clear logs to AAI_ERROR.log for better visibility and readability through implementation.


